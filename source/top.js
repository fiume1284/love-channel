"use strict";

var channelId;
var channelIconUrl;

$(function () {
  var firebaseConfig = {
    apiKey: "AIzaSyBV-Toqtl1kzXyY1roeQZoeLE3fBTg_3Yw",
    authDomain: "youtube-view-counter-b55c2.firebaseapp.com",
    databaseURL: "https://youtube-view-counter-b55c2.firebaseio.com",
    projectId: "youtube-view-counter-b55c2",
    storageBucket: "youtube-view-counter-b55c2.appspot.com",
    messagingSenderId: "375316669656"
  };
  firebase.initializeApp(firebaseConfig);

  var ref = firebase.database().ref("channel_icons/html");
  ref.on("value", function (snapshot) {
    $("#output").html(snapshot.A.B);
  });

  var videoId = getVideoIdFromUrl();
  var channelIconUrl = searchChannelIconFromVideoId(videoId);

  searchRelatedVideoFromVideoId(videoId);
});

/**
 * 動画IDを返す
 */
function getVideoIdFromUrl() {
  var videoId = "jNQXAC9IVRw"; // YouTube最古の動画
  var urlQueries = getUrlVars(); // 注意： getUrlVars は subtitle.js のメソッド
  if (urlQueries["v"]) {
    videoId = urlQueries["v"];
  }

  return videoId;
}

/**
 * 動画IDを基にチャンネルアイコンのURLを返す
 */
function searchChannelIconFromVideoId(videoId) {
  var apiKey = "AIzaSyBV-Toqtl1kzXyY1roeQZoeLE3fBTg_3Yw";

  $.get("https://www.googleapis.com/youtube/v3/videos?part=snippet&id=" + videoId + "&key=" + apiKey, function (data) {
    channelId = data["items"][0]["snippet"]["channelId"];
    console.log("channelId = " + channelId);

    return searchChannelIconFromChannelId(channelId);
  });
}

/**
 * チャンネルIDを基にチャンネルアイコンのURLを返す
 */
function searchChannelIconFromChannelId(channelId) {
  var apiKey = "AIzaSyBV-Toqtl1kzXyY1roeQZoeLE3fBTg_3Yw";

  $.get("https://www.googleapis.com/youtube/v3/channels?part=snippet&id=" + channelId + "&key=" + apiKey, function (data) {
    channelIconUrl = data["items"][0]["snippet"]["thumbnails"]["default"]["url"];
    console.log("channelIconUrl = " + channelIconUrl);

    return channelIconUrl;
  });
}

/**
 * 関連動画を検索し、その一覧をページに出力
 */
function searchRelatedVideoFromVideoId(videoId) {
  var apiKey = "AIzaSyBV-Toqtl1kzXyY1roeQZoeLE3fBTg_3Yw";

  $.get("https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&relatedToVideoId=" + videoId + "&key=" + apiKey, function (data) {
    $("#next-video").html("");

    var items = data["items"];
    for (var i = 0; i < items.length; ++i) {
      var relatedVideoTitle = items[i]["snippet"]["title"];
      var relatedVideoId = items[i]["id"]["videoId"];

      $("#next-video").append('<row>\
          <div class="col-sm-12">\
            <a class="btn btn-primary" \
            href="http://localhost:8014/?surl=5seconds.srt&autoplay=1&v=' + relatedVideoId + '">' + relatedVideoTitle + '</a>\
          </div>\
        </row>');
    }
  });
}

function addIcon() {
  $("#output").append("<img src=\"" + channelIconUrl + "\">");

  firebase.database().ref("channel_icons").set({
    html: $("#output").html()
  });
}

function gotoNextVideo(videoId) {
  location.href = "http://localhost:8014/?surl=5seconds.srt&autoplay=1&v=" + videoId;
}

/**
 * 出力エリアのすべてのアイコンとDBデータを削除
 */
function removeAllIcons() {
  if (confirm("本当に削除してよろしいですか？") === true) {
    $("#output").html("");

    firebase.database().ref("channel_icons").remove();
  }
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvcC5lczYiXSwibmFtZXMiOlsiY2hhbm5lbElkIiwiY2hhbm5lbEljb25VcmwiLCIkIiwiZmlyZWJhc2VDb25maWciLCJhcGlLZXkiLCJhdXRoRG9tYWluIiwiZGF0YWJhc2VVUkwiLCJwcm9qZWN0SWQiLCJzdG9yYWdlQnVja2V0IiwibWVzc2FnaW5nU2VuZGVySWQiLCJmaXJlYmFzZSIsImluaXRpYWxpemVBcHAiLCJyZWYiLCJkYXRhYmFzZSIsIm9uIiwic25hcHNob3QiLCJodG1sIiwiQSIsIkIiLCJ2aWRlb0lkIiwiZ2V0VmlkZW9JZEZyb21VcmwiLCJzZWFyY2hDaGFubmVsSWNvbkZyb21WaWRlb0lkIiwic2VhcmNoUmVsYXRlZFZpZGVvRnJvbVZpZGVvSWQiLCJ1cmxRdWVyaWVzIiwiZ2V0VXJsVmFycyIsImdldCIsImRhdGEiLCJjb25zb2xlIiwibG9nIiwic2VhcmNoQ2hhbm5lbEljb25Gcm9tQ2hhbm5lbElkIiwiaXRlbXMiLCJpIiwibGVuZ3RoIiwicmVsYXRlZFZpZGVvVGl0bGUiLCJyZWxhdGVkVmlkZW9JZCIsImFwcGVuZCIsImFkZEljb24iLCJzZXQiLCJnb3RvTmV4dFZpZGVvIiwibG9jYXRpb24iLCJocmVmIiwicmVtb3ZlQWxsSWNvbnMiLCJjb25maXJtIiwicmVtb3ZlIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLFNBQUo7QUFDQSxJQUFJQyxjQUFKOztBQUVBQyxFQUFFLFlBQVc7QUFDWCxNQUFJQyxpQkFBaUI7QUFDbkJDLFlBQVEseUNBRFc7QUFFbkJDLGdCQUFZLDRDQUZPO0FBR25CQyxpQkFBYSxtREFITTtBQUluQkMsZUFBVyw0QkFKUTtBQUtuQkMsbUJBQWUsd0NBTEk7QUFNbkJDLHVCQUFtQjtBQU5BLEdBQXJCO0FBUUFDLFdBQVNDLGFBQVQsQ0FBdUJSLGNBQXZCOztBQUVBLE1BQUlTLE1BQU1GLFNBQVNHLFFBQVQsR0FBb0JELEdBQXBCLENBQXdCLG9CQUF4QixDQUFWO0FBQ0FBLE1BQUlFLEVBQUosQ0FBTyxP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LDJEQUEyRHJCLE9BQTNFO0FBQ0Q7O0FBRUQ7OztBQUdBLFNBQVNzQixjQUFULEdBQTBCO0FBQ3hCLE1BQUdDLFFBQVEsaUJBQVIsTUFBK0IsSUFBbEMsRUFBd0M7QUFDdEN4QyxNQUFFLFNBQUYsRUFBYWMsSUFBYixDQUFrQixFQUFsQjs7QUFFQU4sYUFBU0csUUFBVCxHQUFvQkQsR0FBcEIsQ0FBd0IsZUFBeEIsRUFBeUMrQixNQUF6QztBQUNEO0FBQ0YiLCJmaWxlIjoidG9wLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGNoYW5uZWxJZDtcbnZhciBjaGFubmVsSWNvblVybDtcblxuJChmdW5jdGlvbigpIHtcbiAgdmFyIGZpcmViYXNlQ29uZmlnID0ge1xuICAgIGFwaUtleTogXCJBSXphU3lCVi1Ub3F0bDFrelh5WTFyb2VRWm9lTEUzZkJUZ18zWXdcIixcbiAgICBhdXRoRG9tYWluOiBcInlvdXR1YmUtdmlldy1jb3VudGVyLWI1NWMyLmZpcmViYXNlYXBwLmNvbVwiLFxuICAgIGRhdGFiYXNlVVJMOiBcImh0dHBzOi8veW91dHViZS12aWV3LWNvdW50ZXItYjU1YzIuZmlyZWJhc2Vpby5jb21cIixcbiAgICBwcm9qZWN0SWQ6IFwieW91dHViZS12aWV3LWNvdW50ZXItYjU1YzJcIixcbiAgICBzdG9yYWdlQnVja2V0OiBcInlvdXR1YmUtdmlldy1jb3VudGVyLWI1NWMyLmFwcHNwb3QuY29tXCIsXG4gICAgbWVzc2FnaW5nU2VuZGVySWQ6IFwiMzc1MzE2NjY5NjU2XCJcbiAgfTtcbiAgZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcChmaXJlYmFzZUNvbmZpZyk7XG5cbiAgdmFyIHJlZiA9IGZpcmViYXNlLmRhdGFiYXNlKCkucmVmKFwiY2hhbm5lbF9pY29ucy9odG1sXCIpO1xuICByZWYub24oXCJ2YWx1ZVwiLCBmdW5jdGlvbihzbmFwc2hvdCkge1xuICAgICQoXCIjb3V0cHV0XCIpLmh0bWwoc25hcHNob3QuQS5CKTtcbiAgfSk7XG5cbiAgdmFyIHZpZGVvSWQgPSBnZXRWaWRlb0lkRnJvbVVybCgpO1xuICB2YXIgY2hhbm5lbEljb25VcmwgPSBzZWFyY2hDaGFubmVsSWNvbkZyb21WaWRlb0lkKHZpZGVvSWQpO1xuXG4gIHNlYXJjaFJlbGF0ZWRWaWRlb0Zyb21WaWRlb0lkKHZpZGVvSWQpO1xufSk7XG5cbi8qKlxuICog5YuV55S7SUTjgpLov5TjgZlcbiAqL1xuZnVuY3Rpb24gZ2V0VmlkZW9JZEZyb21VcmwoKSB7XG4gIHZhciB2aWRlb0lkID0gXCJqTlFYQUM5SVZSd1wiIC8vIFlvdVR1YmXmnIDlj6Tjga7li5XnlLtcbiAgdmFyIHVybFF1ZXJpZXMgPSBnZXRVcmxWYXJzKCk7IC8vIOazqOaEj++8miBnZXRVcmxWYXJzIOOBryBzdWJ0aXRsZS5qcyDjga7jg6Hjgr3jg4Pjg4lcbiAgaWYgKHVybFF1ZXJpZXNbXCJ2XCJdKSB7XG4gICAgdmlkZW9JZCA9IHVybFF1ZXJpZXNbXCJ2XCJdO1xuICB9XG5cbiAgcmV0dXJuIHZpZGVvSWQ7XG59XG5cbi8qKlxuICog5YuV55S7SUTjgpLln7rjgavjg4Hjg6Pjg7Pjg43jg6vjgqLjgqTjgrPjg7Pjga5VUkzjgpLov5TjgZlcbiAqL1xuZnVuY3Rpb24gc2VhcmNoQ2hhbm5lbEljb25Gcm9tVmlkZW9JZCh2aWRlb0lkKSB7XG4gIGNvbnN0IGFwaUtleSA9IFwiQUl6YVN5QlYtVG9xdGwxa3pYeVkxcm9lUVpvZUxFM2ZCVGdfM1l3XCI7XG5cbiAgJC5nZXQoXCJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS95b3V0dWJlL3YzL3ZpZGVvcz9wYXJ0PXNuaXBwZXQmaWQ9XCIgKyB2aWRlb0lkICsgXCIma2V5PVwiICsgYXBpS2V5LCBmdW5jdGlvbihkYXRhKSB7XG4gICAgY2hhbm5lbElkID0gZGF0YVtcIml0ZW1zXCJdWzBdW1wic25pcHBldFwiXVtcImNoYW5uZWxJZFwiXTtcbiAgICBjb25zb2xlLmxvZyhcImNoYW5uZWxJZCA9IFwiICsgY2hhbm5lbElkKTtcblxuICAgIHJldHVybiBzZWFyY2hDaGFubmVsSWNvbkZyb21DaGFubmVsSWQoY2hhbm5lbElkKTtcbiAgfSk7XG59XG5cbi8qKlxuICog44OB44Oj44Oz44ON44OrSUTjgpLln7rjgavjg4Hjg6Pjg7Pjg43jg6vjgqLjgqTjgrPjg7Pjga5VUkzjgpLov5TjgZlcbiAqL1xuZnVuY3Rpb24gc2VhcmNoQ2hhbm5lbEljb25Gcm9tQ2hhbm5lbElkKGNoYW5uZWxJZCkge1xuICBjb25zdCBhcGlLZXkgPSBcIkFJemFTeUJWLVRvcXRsMWt6WHlZMXJvZVFab2VMRTNmQlRnXzNZd1wiO1xuXG4gICQuZ2V0KFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20veW91dHViZS92My9jaGFubmVscz9wYXJ0PXNuaXBwZXQmaWQ9XCIgKyBjaGFubmVsSWQgKyBcIiZrZXk9XCIgKyBhcGlLZXksIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICBjaGFubmVsSWNvblVybCA9IGRhdGFbXCJpdGVtc1wiXVswXVtcInNuaXBwZXRcIl1bXCJ0aHVtYm5haWxzXCJdW1wiZGVmYXVsdFwiXVtcInVybFwiXTtcbiAgICBjb25zb2xlLmxvZyhcImNoYW5uZWxJY29uVXJsID0gXCIgKyBjaGFubmVsSWNvblVybCk7XG5cbiAgICByZXR1cm4gY2hhbm5lbEljb25Vcmw7XG4gIH0pO1xufVxuXG4vKipcbiAqIOmWoumAo+WLleeUu+OCkuaknOe0ouOBl+OAgeOBneOBruS4gOimp+OCkuODmuODvOOCuOOBq+WHuuWKm1xuICovXG5mdW5jdGlvbiBzZWFyY2hSZWxhdGVkVmlkZW9Gcm9tVmlkZW9JZCh2aWRlb0lkKSB7XG4gIGNvbnN0IGFwaUtleSA9IFwiQUl6YVN5QlYtVG9xdGwxa3pYeVkxcm9lUVpvZUxFM2ZCVGdfM1l3XCI7XG5cbiAgJC5nZXQoXCJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS95b3V0dWJlL3YzL3NlYXJjaD9wYXJ0PXNuaXBwZXQmdHlwZT12aWRlbyZyZWxhdGVkVG9WaWRlb0lkPVwiICsgdmlkZW9JZCArIFwiJmtleT1cIiArIGFwaUtleSwgZnVuY3Rpb24oZGF0YSkge1xuICAgICQoXCIjbmV4dC12aWRlb1wiKS5odG1sKFwiXCIpO1xuXG4gICAgdmFyIGl0ZW1zID0gZGF0YVtcIml0ZW1zXCJdO1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIHJlbGF0ZWRWaWRlb1RpdGxlID0gaXRlbXNbaV1bXCJzbmlwcGV0XCJdW1widGl0bGVcIl07XG4gICAgICB2YXIgcmVsYXRlZFZpZGVvSWQgPSBpdGVtc1tpXVtcImlkXCJdW1widmlkZW9JZFwiXTtcblxuICAgICAgJChcIiNuZXh0LXZpZGVvXCIpLmFwcGVuZChcbiAgICAgICAgJzxyb3c+XFxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTEyXCI+XFxcbiAgICAgICAgICAgIDxhIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5XCIgXFxcbiAgICAgICAgICAgIGhyZWY9XCJodHRwOi8vbG9jYWxob3N0OjgwMTQvP3N1cmw9NXNlY29uZHMuc3J0JmF1dG9wbGF5PTEmdj0nICsgcmVsYXRlZFZpZGVvSWQgKyAnXCI+JyArIHJlbGF0ZWRWaWRlb1RpdGxlICsgJzwvYT5cXFxuICAgICAgICAgIDwvZGl2PlxcXG4gICAgICAgIDwvcm93PidcbiAgICAgICk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gYWRkSWNvbigpIHtcbiAgJChcIiNvdXRwdXRcIikuYXBwZW5kKFwiPGltZyBzcmM9XFxcIlwiICsgY2hhbm5lbEljb25VcmwgKyBcIlxcXCI+XCIpO1xuXG4gIGZpcmViYXNlLmRhdGFiYXNlKCkucmVmKFwiY2hhbm5lbF9pY29uc1wiKS5zZXQoe1xuICAgIGh0bWw6ICQoXCIjb3V0cHV0XCIpLmh0bWwoKVxuICB9KTtcbn1cblxuZnVuY3Rpb24gZ290b05leHRWaWRlbyh2aWRlb0lkKSB7XG4gIGxvY2F0aW9uLmhyZWYgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6ODAxNC8/c3VybD01c2Vjb25kcy5zcnQmYXV0b3BsYXk9MSZ2PVwiICsgdmlkZW9JZDtcbn1cblxuLyoqXG4gKiDlh7rlipvjgqjjg6rjgqLjga7jgZnjgbnjgabjga7jgqLjgqTjgrPjg7PjgahEQuODh+ODvOOCv+OCkuWJiumZpFxuICovXG5mdW5jdGlvbiByZW1vdmVBbGxJY29ucygpIHtcbiAgaWYoY29uZmlybShcIuacrOW9k+OBq+WJiumZpOOBl+OBpuOCiOOCjeOBl+OBhOOBp+OBmeOBi++8n1wiKSA9PT0gdHJ1ZSkge1xuICAgICQoXCIjb3V0cHV0XCIpLmh0bWwoXCJcIik7XG5cbiAgICBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZihcImNoYW5uZWxfaWNvbnNcIikucmVtb3ZlKCk7XG4gIH1cbn1cbiJdfQ==
