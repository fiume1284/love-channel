"use strict";

var channelId;
var channelIconUrl;
var cookieKeyName = "srtjs-channel-icons-output";

$(function () {
  var htmlFromCookie = $.cookie(cookieKeyName);
  $("#output").html(htmlFromCookie);

  var videoId = getVideoIdFromUrl();
  var channelIconUrl = searchChannelIconFromVideoId(videoId);

  searchRelatedVideoFromVideoId(videoId);

  console.log("channelIconUrl = " + channelIconUrl);
});

/**
 * 動画IDを返す
 */
function getVideoIdFromUrl() {
  var videoId = "jNQXAC9IVRw"; // YouTube最古の動画
  var urlQueries = getUrlVars(); // 注意： getUrlVars は subtitle.js のメソッド
  if (urlQueries["v"]) {
    videoId = urlQueries["v"];
  }

  return videoId;
}

/**
 * 動画IDを基にチャンネルアイコンのURLを返す
 */
function searchChannelIconFromVideoId(videoId) {
  var apiKey = "AIzaSyBV-Toqtl1kzXyY1roeQZoeLE3fBTg_3Yw";

  $.get("https://www.googleapis.com/youtube/v3/videos?part=snippet&id=" + videoId + "&key=" + apiKey, function (data) {
    channelId = data["items"][0]["snippet"]["channelId"];
    console.log("channelId = " + channelId);

    return searchChannelIconFromChannelId(channelId);
  });
}

/**
 * チャンネルIDを基にチャンネルアイコンのURLを返す
 */
function searchChannelIconFromChannelId(channelId) {
  var apiKey = "AIzaSyBV-Toqtl1kzXyY1roeQZoeLE3fBTg_3Yw";

  $.get("https://www.googleapis.com/youtube/v3/channels?part=snippet&id=" + channelId + "&key=" + apiKey, function (data) {
    channelIconUrl = data["items"][0]["snippet"]["thumbnails"]["default"]["url"];
    console.log("channelIconUrl = " + channelIconUrl);

    return channelIconUrl;
  });
}

/**
 * 関連動画を検索し、ランダムにひとつ動画IDを返す
 */
function searchRelatedVideoFromVideoId(videoId) {
  var apiKey = "AIzaSyBV-Toqtl1kzXyY1roeQZoeLE3fBTg_3Yw";

  console.log("xxx" + videoId);

  $.get("https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&relatedToVideoId=" + videoId + "&key=" + apiKey, function (data) {
    $("#next-video").html("");

    var items = data["items"];
    for (var i = 0; i < items.length; ++i) {
      console.log(items[i]);
      var relatedVideoTitle = items[i]["snippet"]["title"];
      var relatedVideoId = items[i]["id"]["videoId"];

      $("#next-video").append('<row>\
          <div class="col-sm-12">\
            <a class="btn btn-primary" \
            href="http://localhost:8014/?surl=5seconds.srt&autoplay=1&v=' + relatedVideoId + '">' + relatedVideoTitle + '</a>\
          </div>\
        </row>');
    }
  });
}

function addText() {
  $("#output").append("<img src=\"" + channelIconUrl + "\">");

  $.cookie(cookieKeyName, $("#output").html(), { path: "/" });
}

function gotoNextVideo(videoId) {
  location.href = "http://localhost:8014/?surl=5seconds.srt&autoplay=1&v=" + videoId;
}

/**
 * 出力エリアのすべてのアイコンとクッキーを削除
 */
function removeAllIcons() {
  if (confirm("本当に削除してよろしいですか？") === true) {
    $("#output").html("");
    deleteCookie();
  }
}

/**
 * クッキーの削除
 */
function deleteCookie() {
  $.removeCookie(cookieKeyName, { path: "/" });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvcC5lczYiXSwibmFtZXMiOlsiY2hhbm5lbElkIiwiY2hhbm5lbEljb25VcmwiLCJjb29raWVLZXlOYW1lIiwiJCIsImh0bWxGcm9tQ29va2llIiwiY29va2llIiwiaHRtbCIsInZpZGVvSWQiLCJnZXRWaWRlb0lkRnJvbVVybCIsInNlYXJjaENoYW5uZWxJY29uRnJvbVZpZGVvSWQiLCJzZWFyY2hSZWxhdGVkVmlkZW9Gcm9tVmlkZW9JZCIsImNvbnNvbGUiLCJsb2ciLCJ1cmxRdWVyaWVzIiwiZ2V0VXJsVmFycyIsImFwaUtleSIsImdldCIsImRhdGEiLCJzZWFyY2hDaGFubmVsSWNvbkZyb21DaGFubmVsSWQiLCJpdGVtcyIsImkiLCJsZW5ndGgiLCJyZWxhdGVkVmlkZW9UaXRsZSIsInJlbGF0ZWRWaWRlb0lkIiwiYXBwZW5kIiwiYWRkVGV4dCIsInBhdGgiLCJnb3RvTmV4dFZpZGVvIiwibG9jYXRpb24iLCJocmVmIiwicmVtb3ZlQWxsSWNvbnMiLCJjb25maXJtIiwiZGVsZXRlQ29va2llIiwicmVtb3ZlQ29va2llIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLFNBQUo7QUFDQSxJQUFJQyxjQUFKO0FBQ0EsSUFBSUMsZ0JBQWdCLDRCQUFwQjs7QUFFQUMsRUFBRSxZQUFXO0FBQ1gsTUFBSUMsaUJBQWlCRCxFQUFFRSxNQUFGLENBQVNILGFBQVQsQ0FBckI7QUFDQUMsSUFBRSxTQUFGLEVBQWFHLElBQWIsQ0FBa0JGLGNBQWxCOztBQUVBLE1BQUlHLFVBQVVDLG1CQUFkO0FBQ0EsTUFBSVAsaUJBQWlCUSw2QkFBNkJGLE9BQTdCLENBQXJCOztBQUVBRyxnQ0FBOEJILE9BQTlCOztBQUVBSSxVQUFRQyxHQUFSLENBQVksc0JBQXNCWCxjQUFsQztBQUNELENBVkQ7O0FBWUE7OztBQUdBLFNBQVNPLGlCQUFULEdBQTZCO0FBQzNCLE1BQUlELFVBQVUsYUFBZCxDQUQyQixDQUNDO0FBQzVCLE1BQUlNLGFBQWFDLFlBQWpCLENBRjJCLENBRUk7QUFD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aWxlIjoidG9wLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGNoYW5uZWxJZDtcbnZhciBjaGFubmVsSWNvblVybDtcbnZhciBjb29raWVLZXlOYW1lID0gXCJzcnRqcy1jaGFubmVsLWljb25zLW91dHB1dFwiO1xuXG4kKGZ1bmN0aW9uKCkge1xuICB2YXIgaHRtbEZyb21Db29raWUgPSAkLmNvb2tpZShjb29raWVLZXlOYW1lKTtcbiAgJChcIiNvdXRwdXRcIikuaHRtbChodG1sRnJvbUNvb2tpZSk7XG5cbiAgdmFyIHZpZGVvSWQgPSBnZXRWaWRlb0lkRnJvbVVybCgpO1xuICB2YXIgY2hhbm5lbEljb25VcmwgPSBzZWFyY2hDaGFubmVsSWNvbkZyb21WaWRlb0lkKHZpZGVvSWQpO1xuXG4gIHNlYXJjaFJlbGF0ZWRWaWRlb0Zyb21WaWRlb0lkKHZpZGVvSWQpO1xuXG4gIGNvbnNvbGUubG9nKFwiY2hhbm5lbEljb25VcmwgPSBcIiArIGNoYW5uZWxJY29uVXJsKTtcbn0pO1xuXG4vKipcbiAqIOWLleeUu0lE44KS6L+U44GZXG4gKi9cbmZ1bmN0aW9uIGdldFZpZGVvSWRGcm9tVXJsKCkge1xuICB2YXIgdmlkZW9JZCA9IFwiak5RWEFDOUlWUndcIiAvLyBZb3VUdWJl5pyA5Y+k44Gu5YuV55S7XG4gIHZhciB1cmxRdWVyaWVzID0gZ2V0VXJsVmFycygpOyAvLyDms6jmhI/vvJogZ2V0VXJsVmFycyDjga8gc3VidGl0bGUuanMg44Gu44Oh44K944OD44OJXG4gIGlmICh1cmxRdWVyaWVzW1widlwiXSkge1xuICAgIHZpZGVvSWQgPSB1cmxRdWVyaWVzW1widlwiXTtcbiAgfVxuXG4gIHJldHVybiB2aWRlb0lkO1xufVxuXG4vKipcbiAqIOWLleeUu0lE44KS5Z+644Gr44OB44Oj44Oz44ON44Or44Ki44Kk44Kz44Oz44GuVVJM44KS6L+U44GZXG4gKi9cbmZ1bmN0aW9uIHNlYXJjaENoYW5uZWxJY29uRnJvbVZpZGVvSWQodmlkZW9JZCkge1xuICBjb25zdCBhcGlLZXkgPSBcIkFJemFTeUJWLVRvcXRsMWt6WHlZMXJvZVFab2VMRTNmQlRnXzNZd1wiO1xuXG4gICQuZ2V0KFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20veW91dHViZS92My92aWRlb3M/cGFydD1zbmlwcGV0JmlkPVwiICsgdmlkZW9JZCArIFwiJmtleT1cIiArIGFwaUtleSwgZnVuY3Rpb24oZGF0YSkge1xuICAgIGNoYW5uZWxJZCA9IGRhdGFbXCJpdGVtc1wiXVswXVtcInNuaXBwZXRcIl1bXCJjaGFubmVsSWRcIl07XG4gICAgY29uc29sZS5sb2coXCJjaGFubmVsSWQgPSBcIiArIGNoYW5uZWxJZCk7XG5cbiAgICByZXR1cm4gc2VhcmNoQ2hhbm5lbEljb25Gcm9tQ2hhbm5lbElkKGNoYW5uZWxJZCk7XG4gIH0pO1xufVxuXG4vKipcbiAqIOODgeODo+ODs+ODjeODq0lE44KS5Z+644Gr44OB44Oj44Oz44ON44Or44Ki44Kk44Kz44Oz44GuVVJM44KS6L+U44GZXG4gKi9cbmZ1bmN0aW9uIHNlYXJjaENoYW5uZWxJY29uRnJvbUNoYW5uZWxJZChjaGFubmVsSWQpIHtcbiAgY29uc3QgYXBpS2V5ID0gXCJBSXphU3lCVi1Ub3F0bDFrelh5WTFyb2VRWm9lTEUzZkJUZ18zWXdcIjtcblxuICAkLmdldChcImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3lvdXR1YmUvdjMvY2hhbm5lbHM/cGFydD1zbmlwcGV0JmlkPVwiICsgY2hhbm5lbElkICsgXCIma2V5PVwiICsgYXBpS2V5LCBmdW5jdGlvbihkYXRhKSB7XG4gICAgY2hhbm5lbEljb25VcmwgPSBkYXRhW1wiaXRlbXNcIl1bMF1bXCJzbmlwcGV0XCJdW1widGh1bWJuYWlsc1wiXVtcImRlZmF1bHRcIl1bXCJ1cmxcIl07XG4gICAgY29uc29sZS5sb2coXCJjaGFubmVsSWNvblVybCA9IFwiICsgY2hhbm5lbEljb25VcmwpO1xuXG4gICAgcmV0dXJuIGNoYW5uZWxJY29uVXJsO1xuICB9KTtcbn1cblxuLyoqXG4gKiDplqLpgKPli5XnlLvjgpLmpJzntKLjgZfjgIHjg6njg7Pjg4Djg6DjgavjgbLjgajjgaTli5XnlLtJROOCkui/lOOBmVxuICovXG5mdW5jdGlvbiBzZWFyY2hSZWxhdGVkVmlkZW9Gcm9tVmlkZW9JZCh2aWRlb0lkKSB7XG4gIGNvbnN0IGFwaUtleSA9IFwiQUl6YVN5QlYtVG9xdGwxa3pYeVkxcm9lUVpvZUxFM2ZCVGdfM1l3XCI7XG5cbiAgY29uc29sZS5sb2coXCJ4eHhcIiArIHZpZGVvSWQpO1xuXG4gICQuZ2V0KFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20veW91dHViZS92My9zZWFyY2g/cGFydD1zbmlwcGV0JnR5cGU9dmlkZW8mcmVsYXRlZFRvVmlkZW9JZD1cIiArIHZpZGVvSWQgKyBcIiZrZXk9XCIgKyBhcGlLZXksIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAkKFwiI25leHQtdmlkZW9cIikuaHRtbChcIlwiKTtcblxuICAgIHZhciBpdGVtcyA9IGRhdGFbXCJpdGVtc1wiXTtcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyArK2kpIHtcbiAgICAgIGNvbnNvbGUubG9nKGl0ZW1zW2ldKTtcbiAgICAgIHZhciByZWxhdGVkVmlkZW9UaXRsZSA9IGl0ZW1zW2ldW1wic25pcHBldFwiXVtcInRpdGxlXCJdO1xuICAgICAgdmFyIHJlbGF0ZWRWaWRlb0lkID0gaXRlbXNbaV1bXCJpZFwiXVtcInZpZGVvSWRcIl07XG5cbiAgICAgICQoXCIjbmV4dC12aWRlb1wiKS5hcHBlbmQoXG4gICAgICAgICc8cm93PlxcXG4gICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS0xMlwiPlxcXG4gICAgICAgICAgICA8YSBjbGFzcz1cImJ0biBidG4tcHJpbWFyeVwiIFxcXG4gICAgICAgICAgICBocmVmPVwiaHR0cDovL2xvY2FsaG9zdDo4MDE0Lz9zdXJsPTVzZWNvbmRzLnNydCZhdXRvcGxheT0xJnY9JyArIHJlbGF0ZWRWaWRlb0lkICsgJ1wiPicgKyByZWxhdGVkVmlkZW9UaXRsZSArICc8L2E+XFxcbiAgICAgICAgICA8L2Rpdj5cXFxuICAgICAgICA8L3Jvdz4nXG4gICAgICApO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGFkZFRleHQoKSB7XG4gICQoXCIjb3V0cHV0XCIpLmFwcGVuZChcIjxpbWcgc3JjPVxcXCJcIiArIGNoYW5uZWxJY29uVXJsICsgXCJcXFwiPlwiKTtcblxuICAkLmNvb2tpZShjb29raWVLZXlOYW1lLCAkKFwiI291dHB1dFwiKS5odG1sKCksIHtwYXRoOiBcIi9cIn0pO1xufVxuXG5mdW5jdGlvbiBnb3RvTmV4dFZpZGVvKHZpZGVvSWQpIHtcbiAgbG9jYXRpb24uaHJlZiA9IFwiaHR0cDovL2xvY2FsaG9zdDo4MDE0Lz9zdXJsPTVzZWNvbmRzLnNydCZhdXRvcGxheT0xJnY9XCIgKyB2aWRlb0lkO1xufVxuXG4vKipcbiAqIOWHuuWKm+OCqOODquOCouOBruOBmeOBueOBpuOBruOCouOCpOOCs+ODs+OBqOOCr+ODg+OCreODvOOCkuWJiumZpFxuICovXG5mdW5jdGlvbiByZW1vdmVBbGxJY29ucygpIHtcbiAgaWYoY29uZmlybShcIuacrOW9k+OBq+WJiumZpOOBl+OBpuOCiOOCjeOBl+OBhOOBp+OBmeOBi++8n1wiKSA9PT0gdHJ1ZSkge1xuICAgICQoXCIjb3V0cHV0XCIpLmh0bWwoXCJcIik7XG4gICAgZGVsZXRlQ29va2llKCk7XG4gIH1cbn1cblxuLyoqXG4gKiDjgq/jg4Pjgq3jg7zjga7liYrpmaRcbiAqL1xuZnVuY3Rpb24gZGVsZXRlQ29va2llKCkge1xuICAkLnJlbW92ZUNvb2tpZShjb29raWVLZXlOYW1lLCB7cGF0aDogXCIvXCJ9KTtcbn1cbiJdfQ==
