"use strict";

var channelId;
var channelIconUrl;
var cookieKeyName = "srtjs-channel-icons-output";

$(function () {
  var htmlFromCookie = $.cookie(cookieKeyName);
  $("#output").html(htmlFromCookie);

  var videoId = getVideoIdFromUrl();
  var channelIconUrl = searchChannelIconFromVideoId(videoId);

  searchRelatedVideoFromVideoId(videoId);

  console.log("channelIconUrl = " + channelIconUrl);
});

/**
 * 動画IDを返す
 */
function getVideoIdFromUrl() {
  var videoId = "jNQXAC9IVRw"; // YouTube最古の動画
  var urlQueries = getUrlVars(); // 注意： getUrlVars は subtitle.js のメソッド
  if (urlQueries["v"]) {
    videoId = urlQueries["v"];
  }

  return videoId;
}

/**
 * 動画IDを基にチャンネルアイコンのURLを返す
 */
function searchChannelIconFromVideoId(videoId) {
  var apiKey = "AIzaSyBV-Toqtl1kzXyY1roeQZoeLE3fBTg_3Yw";

  $.get("https://www.googleapis.com/youtube/v3/videos?part=snippet&id=" + videoId + "&key=" + apiKey, function (data) {
    channelId = data["items"][0]["snippet"]["channelId"];
    console.log("channelId = " + channelId);

    return searchChannelIconFromChannelId(channelId);
  });
}

/**
 * チャンネルIDを基にチャンネルアイコンのURLを返す
 */
function searchChannelIconFromChannelId(channelId) {
  var apiKey = "AIzaSyBV-Toqtl1kzXyY1roeQZoeLE3fBTg_3Yw";

  $.get("https://www.googleapis.com/youtube/v3/channels?part=snippet&id=" + channelId + "&key=" + apiKey, function (data) {
    channelIconUrl = data["items"][0]["snippet"]["thumbnails"]["default"]["url"];
    console.log("channelIconUrl = " + channelIconUrl);

    return channelIconUrl;
  });
}

/**
 * 関連動画を検索し、ランダムにひとつ動画IDを返す
 */
function searchRelatedVideoFromVideoId(videoId) {
  var apiKey = "AIzaSyBV-Toqtl1kzXyY1roeQZoeLE3fBTg_3Yw";

  $.get("https://www.googleapis.com/youtube/v3/search?part=snippet&type=snippet&relatedToVideoId" + videoId + "&key=" + apiKey, function (data) {
    $("#next-video").html("");

    var items = data["items"];
    for (var i = 0; i < items.length; ++i) {
      console.log(items[i]);
      var relatedVideoTitle = items[i]["snippet"]["title"];
      var relatedVideoId = items[i]["id"]["videoId"];

      $("#next-video").append('<row>\
          <div class="col-sm-12">\
            <a class="btn btn-primary" \
            href="http://localhost:8014/?surl=5seconds.srt&autoplay=1&v=' + relatedVideoId + '">' + relatedVideoTitle + '</a>\
          </div>\
        </row>');
    }
  });
}

function addText() {
  $("#output").append("<img src=\"" + channelIconUrl + "\">");

  $.cookie(cookieKeyName, $("#output").html(), { path: "/" });
}

function gotoNextVideo(videoId) {
  location.href = "http://localhost:8014/?surl=5seconds.srt&autoplay=1&v=" + videoId;
}

/**
 * 出力エリアのすべてのアイコンとクッキーを削除
 */
function removeAllIcons() {
  if (confirm("本当に削除してよろしいですか？") === true) {
    $("#output").html("");
    deleteCookie();
  }
}

/**
 * クッキーの削除
 */
function deleteCookie() {
  $.removeCookie(cookieKeyName, { path: "/" });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvcC5lczYiXSwibmFtZXMiOlsiY2hhbm5lbElkIiwiY2hhbm5lbEljb25VcmwiLCJjb29raWVLZXlOYW1lIiwiJCIsImh0bWxGcm9tQ29va2llIiwiY29va2llIiwiaHRtbCIsInZpZGVvSWQiLCJnZXRWaWRlb0lkRnJvbVVybCIsInNlYXJjaENoYW5uZWxJY29uRnJvbVZpZGVvSWQiLCJzZWFyY2hSZWxhdGVkVmlkZW9Gcm9tVmlkZW9JZCIsImNvbnNvbGUiLCJsb2ciLCJ1cmxRdWVyaWVzIiwiZ2V0VXJsVmFycyIsImFwaUtleSIsImdldCIsImRhdGEiLCJzZWFyY2hDaGFubmVsSWNvbkZyb21DaGFubmVsSWQiLCJpdGVtcyIsImkiLCJsZW5ndGgiLCJyZWxhdGVkVmlkZW9UaXRsZSIsInJlbGF0ZWRWaWRlb0lkIiwiYXBwZW5kIiwiYWRkVGV4dCIsInBhdGgiLCJnb3RvTmV4dFZpZGVvIiwibG9jYXRpb24iLCJocmVmIiwicmVtb3ZlQWxsSWNvbnMiLCJjb25maXJtIiwiZGVsZXRlQ29va2llIiwicmVtb3ZlQ29va2llIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLFNBQUo7QUFDQSxJQUFJQyxjQUFKO0FBQ0EsSUFBSUMsZ0JBQWdCLDRCQUFwQjs7QUFFQUMsRUFBRSxZQUFXO0FBQ1gsTUFBSUMsaUJBQWlCRCxFQUFFRSxNQUFGLENBQVNILGFBQVQsQ0FBckI7QUFDQUMsSUFBRSxTQUFGLEVBQWFHLElBQWIsQ0FBa0JGLGNBQWxCOztBQUVBLE1BQUlHLFVBQVVDLG1CQUFkO0FBQ0EsTUFBSVAsaUJBQWlCUSw2QkFBNkJGLE9BQTdCLENBQXJCOztBQUVBRyxnQ0FBOEJILE9BQTlCOztBQUVBSSxVQUFRQyxHQUFSLENBQVksc0JBQXNCWCxjQUFsQztBQUNELENBVkQ7O0FBWUE7OztBQUdBLFNBQVNPLGlCQUFULEdBQTZCO0FBQzNCLE1BQUlELFVBQVUsYUFBZCxDQUQyQixDQUNDO0FBQzVCLE1BQUlNLGFBQWFDLFlBQWpCLENBRjJCLENBRUk7QUFD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ciBjaGFubmVsSWQ7XG52YXIgY2hhbm5lbEljb25Vcmw7XG52YXIgY29va2llS2V5TmFtZSA9IFwic3J0anMtY2hhbm5lbC1pY29ucy1vdXRwdXRcIjtcblxuJChmdW5jdGlvbigpIHtcbiAgdmFyIGh0bWxGcm9tQ29va2llID0gJC5jb29raWUoY29va2llS2V5TmFtZSk7XG4gICQoXCIjb3V0cHV0XCIpLmh0bWwoaHRtbEZyb21Db29raWUpO1xuXG4gIHZhciB2aWRlb0lkID0gZ2V0VmlkZW9JZEZyb21VcmwoKTtcbiAgdmFyIGNoYW5uZWxJY29uVXJsID0gc2VhcmNoQ2hhbm5lbEljb25Gcm9tVmlkZW9JZCh2aWRlb0lkKTtcblxuICBzZWFyY2hSZWxhdGVkVmlkZW9Gcm9tVmlkZW9JZCh2aWRlb0lkKTtcblxuICBjb25zb2xlLmxvZyhcImNoYW5uZWxJY29uVXJsID0gXCIgKyBjaGFubmVsSWNvblVybCk7XG59KTtcblxuLyoqXG4gKiDli5XnlLtJROOCkui/lOOBmVxuICovXG5mdW5jdGlvbiBnZXRWaWRlb0lkRnJvbVVybCgpIHtcbiAgdmFyIHZpZGVvSWQgPSBcImpOUVhBQzlJVlJ3XCIgLy8gWW91VHViZeacgOWPpOOBruWLleeUu1xuICB2YXIgdXJsUXVlcmllcyA9IGdldFVybFZhcnMoKTsgLy8g5rOo5oSP77yaIGdldFVybFZhcnMg44GvIHN1YnRpdGxlLmpzIOOBruODoeOCveODg+ODiVxuICBpZiAodXJsUXVlcmllc1tcInZcIl0pIHtcbiAgICB2aWRlb0lkID0gdXJsUXVlcmllc1tcInZcIl07XG4gIH1cblxuICByZXR1cm4gdmlkZW9JZDtcbn1cblxuLyoqXG4gKiDli5XnlLtJROOCkuWfuuOBq+ODgeODo+ODs+ODjeODq+OCouOCpOOCs+ODs+OBrlVSTOOCkui/lOOBmVxuICovXG5mdW5jdGlvbiBzZWFyY2hDaGFubmVsSWNvbkZyb21WaWRlb0lkKHZpZGVvSWQpIHtcbiAgY29uc3QgYXBpS2V5ID0gXCJBSXphU3lCVi1Ub3F0bDFrelh5WTFyb2VRWm9lTEUzZkJUZ18zWXdcIjtcblxuICAkLmdldChcImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3lvdXR1YmUvdjMvdmlkZW9zP3BhcnQ9c25pcHBldCZpZD1cIiArIHZpZGVvSWQgKyBcIiZrZXk9XCIgKyBhcGlLZXksIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICBjaGFubmVsSWQgPSBkYXRhW1wiaXRlbXNcIl1bMF1bXCJzbmlwcGV0XCJdW1wiY2hhbm5lbElkXCJdO1xuICAgIGNvbnNvbGUubG9nKFwiY2hhbm5lbElkID0gXCIgKyBjaGFubmVsSWQpO1xuXG4gICAgcmV0dXJuIHNlYXJjaENoYW5uZWxJY29uRnJvbUNoYW5uZWxJZChjaGFubmVsSWQpO1xuICB9KTtcbn1cblxuLyoqXG4gKiDjg4Hjg6Pjg7Pjg43jg6tJROOCkuWfuuOBq+ODgeODo+ODs+ODjeODq+OCouOCpOOCs+ODs+OBrlVSTOOCkui/lOOBmVxuICovXG5mdW5jdGlvbiBzZWFyY2hDaGFubmVsSWNvbkZyb21DaGFubmVsSWQoY2hhbm5lbElkKSB7XG4gIGNvbnN0IGFwaUtleSA9IFwiQUl6YVN5QlYtVG9xdGwxa3pYeVkxcm9lUVpvZUxFM2ZCVGdfM1l3XCI7XG5cbiAgJC5nZXQoXCJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS95b3V0dWJlL3YzL2NoYW5uZWxzP3BhcnQ9c25pcHBldCZpZD1cIiArIGNoYW5uZWxJZCArIFwiJmtleT1cIiArIGFwaUtleSwgZnVuY3Rpb24oZGF0YSkge1xuICAgIGNoYW5uZWxJY29uVXJsID0gZGF0YVtcIml0ZW1zXCJdWzBdW1wic25pcHBldFwiXVtcInRodW1ibmFpbHNcIl1bXCJkZWZhdWx0XCJdW1widXJsXCJdO1xuICAgIGNvbnNvbGUubG9nKFwiY2hhbm5lbEljb25VcmwgPSBcIiArIGNoYW5uZWxJY29uVXJsKTtcblxuICAgIHJldHVybiBjaGFubmVsSWNvblVybDtcbiAgfSk7XG59XG5cbi8qKlxuICog6Zai6YCj5YuV55S744KS5qSc57Si44GX44CB44Op44Oz44OA44Og44Gr44Gy44Go44Gk5YuV55S7SUTjgpLov5TjgZlcbiAqL1xuZnVuY3Rpb24gc2VhcmNoUmVsYXRlZFZpZGVvRnJvbVZpZGVvSWQodmlkZW9JZCkge1xuICBjb25zdCBhcGlLZXkgPSBcIkFJemFTeUJWLVRvcXRsMWt6WHlZMXJvZVFab2VMRTNmQlRnXzNZd1wiO1xuXG4gICQuZ2V0KFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20veW91dHViZS92My9zZWFyY2g/cGFydD1zbmlwcGV0JnR5cGU9c25pcHBldCZyZWxhdGVkVG9WaWRlb0lkXCIgKyB2aWRlb0lkICsgXCIma2V5PVwiICsgYXBpS2V5LCBmdW5jdGlvbihkYXRhKSB7XG4gICAgJChcIiNuZXh0LXZpZGVvXCIpLmh0bWwoXCJcIik7XG5cbiAgICB2YXIgaXRlbXMgPSBkYXRhW1wiaXRlbXNcIl07XG4gICAgZm9yKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgKytpKSB7XG4gICAgICBjb25zb2xlLmxvZyhpdGVtc1tpXSk7XG4gICAgICB2YXIgcmVsYXRlZFZpZGVvVGl0bGUgPSBpdGVtc1tpXVtcInNuaXBwZXRcIl1bXCJ0aXRsZVwiXTtcbiAgICAgIHZhciByZWxhdGVkVmlkZW9JZCA9IGl0ZW1zW2ldW1wiaWRcIl1bXCJ2aWRlb0lkXCJdO1xuXG4gICAgICAkKFwiI25leHQtdmlkZW9cIikuYXBwZW5kKFxuICAgICAgICAnPHJvdz5cXFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tMTJcIj5cXFxuICAgICAgICAgICAgPGEgY2xhc3M9XCJidG4gYnRuLXByaW1hcnlcIiBcXFxuICAgICAgICAgICAgaHJlZj1cImh0dHA6Ly9sb2NhbGhvc3Q6ODAxNC8/c3VybD01c2Vjb25kcy5zcnQmYXV0b3BsYXk9MSZ2PScgKyByZWxhdGVkVmlkZW9JZCArICdcIj4nICsgcmVsYXRlZFZpZGVvVGl0bGUgKyAnPC9hPlxcXG4gICAgICAgICAgPC9kaXY+XFxcbiAgICAgICAgPC9yb3c+J1xuICAgICAgKTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBhZGRUZXh0KCkge1xuICAkKFwiI291dHB1dFwiKS5hcHBlbmQoXCI8aW1nIHNyYz1cXFwiXCIgKyBjaGFubmVsSWNvblVybCArIFwiXFxcIj5cIik7XG5cbiAgJC5jb29raWUoY29va2llS2V5TmFtZSwgJChcIiNvdXRwdXRcIikuaHRtbCgpLCB7cGF0aDogXCIvXCJ9KTtcbn1cblxuZnVuY3Rpb24gZ290b05leHRWaWRlbyh2aWRlb0lkKSB7XG4gIGxvY2F0aW9uLmhyZWYgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6ODAxNC8/c3VybD01c2Vjb25kcy5zcnQmYXV0b3BsYXk9MSZ2PVwiICsgdmlkZW9JZDtcbn1cblxuLyoqXG4gKiDlh7rlipvjgqjjg6rjgqLjga7jgZnjgbnjgabjga7jgqLjgqTjgrPjg7Pjgajjgq/jg4Pjgq3jg7zjgpLliYrpmaRcbiAqL1xuZnVuY3Rpb24gcmVtb3ZlQWxsSWNvbnMoKSB7XG4gIGlmKGNvbmZpcm0oXCLmnKzlvZPjgavliYrpmaTjgZfjgabjgojjgo3jgZfjgYTjgafjgZnjgYvvvJ9cIikgPT09IHRydWUpIHtcbiAgICAkKFwiI291dHB1dFwiKS5odG1sKFwiXCIpO1xuICAgIGRlbGV0ZUNvb2tpZSgpO1xuICB9XG59XG5cbi8qKlxuICog44Kv44OD44Kt44O844Gu5YmK6ZmkXG4gKi9cbmZ1bmN0aW9uIGRlbGV0ZUNvb2tpZSgpIHtcbiAgJC5yZW1vdmVDb29raWUoY29va2llS2V5TmFtZSwge3BhdGg6IFwiL1wifSk7XG59XG4iXX0=
